!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("kefir.atom"),require("kefir"),require("infestines"),require("partial.lenses"),require("karet.lift"),require("karet"),require("react")):"function"==typeof define&&define.amd?define(["exports","kefir.atom","kefir","infestines","partial.lenses","karet.lift","karet","react"],n):n(((t=t||self).karet=t.karet||{},t.karet.util={}),t.Kefir.atom,t.Kefir,t.I,t.L,t.karet.lift,t.karet,t.React)}(this,function(t,i,c,f,p,u,o,r){"use strict";function d(t){for(var n=arguments.length,r=void 0,e=1;e<n;++e){var i=arguments[e];r?r.push(i):m(i)?r=[i]:t=i(t)}return r?Pt(t,$(r)):t}function a(t,n){var r=n[t];if(null!=r)return Ut(t,r)}function l(t,n){for(var r in t)if(!f.identicalU(t[r],n[r]))return!1;return!0}function s(t,n,r){var e={};for(var i in n){var o=n[i];r(i)?e[i]=o:(e[i]=t[i]||(new c.Property).skipDuplicates(f.identicalU))._emitValue(o)}for(var u in t)if(!r(u)){var a=t[u];a!==e[u]&&a._emitEnd()}return e}var h=function(t){return t},n=function(t,i,n){return f.arityN(t+1,h(function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return u.combine(n,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return h(function(){return e[i].apply(e,n)})})}))},e=function(t){return t instanceof i.AbstractMutable},y=function(t){return t instanceof c.Observable},m=function(t){return t instanceof c.Property},v=function(t){return t instanceof c.Stream},g=function(t){},M=function(t,n){return y(n)?n.map(t):t(n)},w=function(t,n){return y(n)?n.flatMapLatest(f.pipe2U(t,W)):t(n)},k=function(t,n){return y(n)?n.flatMap(f.pipe2U(t,W)):t(n)},P=function(t,n){return y(n)?n.flatMapConcat(f.pipe2U(t,W)):t(n)},b=f.curry(function(t,n){return W(n).debounce(t)}),U=function(t){return c.concat(t.map(W))},E=f.curry(function(t,n){return y(n)?n.delay(t):n}),A=f.curry(M),_=f.curry(k),R=f.curry(P),x=f.curry(function(t,n){return W(n).flatMapErrors(f.pipe2U(t,W))}),D=f.curry(w),I=f.curry(function(t,n,r){return y(r)?r.scan(t,n):t(n,r)}),C=f.curry(c.interval),q=f.curry(c.later),S=c.never(),F=f.curry(function(t,n){return W(n).onAny((r=t,function(t){var n;return(n=r[t.type])&&n(t.value)}));var r}),V=f.curry(function(t,n){return W(n).sampledBy(t)}),L=f.curry(function(t,n){return W(n).skip(t)}),O=f.curry(function(t,n){return y(n)?n.skipDuplicates(t):n}),j=f.curry(function(t,n){return W(n).filter(t)}),B=f.curry(function(t,n){return W(n).take(t)}),K=f.curry(function(t,n){return W(n).takeErrors(t)}),N=f.curry(function(t,n){return W(n).takeUntilBy(t)}),W=function(t){return y(t)?t:c.constant(t)},z=function(t){return v(t)?t.toProperty():t},J=f.curry(function(t,n){return W(n).throttle(t)}),T=f.curry(c.fromEvents),G=f.curry(function(t,n){return W(n).toProperty(function(){return t})}),H=f.pipe2U(G(void 0),u.lift(g)),Q=f.pipe2U(A,H),X=f.curry(function(t,n){return W(n).concat(W(t))}),Y=O(f.identicalU),Z=f.curry(function(n,t){return W(t).filter(function(t){return!n(t)})}),$=function(t){return u.combine([t],f.id)},tt=f.inherit(function(t){c.Property.call(this),this.m=t,this.a=void 0},c.Property,{_onActivation:function(){var n=this,t=n.m;if(t){n.m=null;var r=t(),e=r.ready||r;n.a=r.abort,e.then(function(t){null!==n.a&&(n.a=null,n._emitValue(t),n._emitEnd())},function(t){null!==n.a&&(n.a=null,n._emitError(t),n._emitEnd())})}},_onDeactivation:function(){var t=this.a;t&&(this.a=null,this._emitEnd(),t())}}),nt=u.lift(function(t){return!t}),rt=function(r,e){return function(){for(var t=arguments.length,n=t?arguments[--t]:r;t--;)n=e(arguments[t],n);return n}},et=h(rt(!0,function(t,n){return z(w(function(t){return t&&n},t))})),it=h(rt(!1,function(t,n){return z(w(function(t){return t||n},t))})),ot=function(t,n,r){return z(w(function(t){return t?n:r},t))},ut=f.curry(ot),at=f.curry(function(t,n){return ot(t,void 0,n)}),ct=f.arityN(2,ot),ft=f.Monad(function(t,n){return n.map(t).skipDuplicates(f.identicalU)},c.constant,function(t,n){return c.combine([t,n],f.applyU).toProperty().skipDuplicates(f.identicalU)},function(t,n){return n.flatMapLatest(t).toProperty().skipDuplicates(f.identicalU)}),lt=f.IdentityOrU(m,ft),st=f.inherit(function(t){c.Property.call(this),this.d=t,this.s=this.i=0},c.Property,{_onActivation:function(){var e=this;e.i=requestAnimationFrame(function t(n){e.s||(e.s=n);var r=(n-e.s)/e.d;1<r&&(r=1),e._emitValue(r),r<1?e.i=requestAnimationFrame(t):e._emitEnd()})},_onDeactivation:function(){cancelAnimationFrame(this.i)}}),ht="undefined"==typeof window?f.always(S):function(t){return new st(t)},pt=c.Stream.prototype,dt=f.inherit(function(){c.Stream.call(this)},c.Stream,{push:pt._emitValue,error:pt._emitError,end:pt._emitEnd}),yt=function(){return new dt},mt=n(1,"push"),vt=n(1,"error"),gt=n(0,"end"),Mt=function(t){return t()},wt=u.lift(f.curry(function(t,n){return void 0!==n&&t(n),n})),kt=function(t,n){for(var r=0,e=n.length;r<e;++r)t=n[r](t);return t},Pt=function(n,t){return z(w(function(t){return kt(n,t)},t))},bt=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return p.iso(function(t){return console.log.apply(console,n.concat([t]))||t},function(t){return console.log.apply(console,n.concat([t,"(set)"]))||t})},Ut=function(r,e){return function(t){var n=t.target[r];f.isFunction(e.push)?e.push(n):e.set(n)}},Et=function(e,t,i){return r.forwardRef(h(function(t,n){var r=a("value",t)||i&&a(i,t);return r&&(t=p.set("onChange",Dt(r,t.onChange),t)),o.createElement(e,n?p.set("ref",n,t):t)}))},At=Et("select"),_t=Et("input",0,"checked"),Rt=Et("textarea"),xt=p.collect([p.flatten,p.when(f.isFunction)]),Dt=u.lift(function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=xt(n);switch(e.length){case 0:return;case 1:return e[0];default:return function(r){i.holding(function(){for(var t=0,n=e.length;t<n;++t)e[t](r)})}}}),It=function(n){return h(function(t){return t[n]()})},Ct=It("preventDefault"),qt=It("stopPropagation"),St=p.join(" ",[p.flatten,p.when(f.id)]),Ft=u.lift(function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return St(n)||void 0}),Vt=function(t){return f.inherit(function(t){r.PureComponent.call(this,t)},r.PureComponent,{render:function(){return r.createElement(t,this.props)}})},Lt=f.curry(function(e,t){var n=Vt(t);return f.inherit(function(t){r.PureComponent.call(this,t),this.o=s(f.object0,t,e)},r.PureComponent,{componentDidUpdate:function(){var t,n,r=this.o;l(t=r,n=this.o=s(r,this.props,e))&&l(n,t)||this.forceUpdate()},render:function(){return r.createElement(n,this.o)},componentWillUnmount:function(){s(this.o,f.object0,e)}})}),Ot=Lt(f.always(!1)),jt=u.lift(JSON.parse),Bt=u.lift(JSON.stringify),Kt=u.lift(decodeURI),Nt=u.lift(decodeURIComponent),Wt=u.lift(encodeURI),zt=u.lift(encodeURIComponent),Jt=u.lift(Math.abs),Tt=u.lift(Math.acos),Gt=u.lift(Math.acosh),Ht=u.lift(Math.asin),Qt=u.lift(Math.asinh),Xt=u.lift(Math.atan),Yt=u.lift(Math.atan2),Zt=u.lift(Math.atanh),$t=u.lift(Math.cbrt),tn=u.lift(Math.ceil),nn=u.lift(Math.clz32),rn=u.lift(Math.cos),en=u.lift(Math.cosh),on=u.lift(Math.exp),un=u.lift(Math.expm1),an=u.lift(Math.floor),cn=u.lift(Math.fround),fn=u.lift(Math.hypot),ln=u.lift(Math.imul),sn=u.lift(Math.log),hn=u.lift(Math.log10),pn=u.lift(Math.log1p),dn=u.lift(Math.log2),yn=u.lift(Math.max),mn=u.lift(Math.min),vn=u.lift(Math.pow),gn=u.lift(Math.round),Mn=u.lift(Math.sign),wn=u.lift(Math.sin),kn=u.lift(Math.sinh),Pn=u.lift(Math.sqrt),bn=u.lift(Math.tan),Un=u.lift(Math.tanh),En=u.lift(Math.trunc),An=u.lift(String.raw),_n=f.curry(function(n,t){var r=u.combine([t],function(t){return n.set(t)});if(m(r))return r.toProperty(g)}),Rn=n(1,"modify"),xn=n(1,"set"),Dn=n(0,"remove"),In=function(t,n){return t.view(n)},Cn=function(t,n){return u.combine([n,t],p.get)},qn=function(t,n){return p.get(n,t)},Sn=function(t){return e(t)?In:m(t)?Cn:qn},Fn=function(t){return function(){throw Error("destructure: `"+t+"` unsupported")}},Vn={deleteProperty:Fn("deleteProperty"),has:Fn("has"),ownKeys:Fn("ownKeys"),set:Fn("set")},Ln=f.assign({},Vn,{get:In,set:function(t,n,r){return!t.modify(p.set(n,r))},deleteProperty:function(t,n){return!t.modify(p.remove(n))}}),On=f.assign({},Vn,{get:Cn}),jn=f.curry(function(t,n){return e(n)?m($(t))?new i.Join(u.combine([t],function(t){return n.view(t)})):In(n,t):Cn(n,t)}),Bn=f.curry(function(c,f){var l=[],s=Sn(f);return d(f,I(function(t,n){var r=t.length,e=n?n.length:0;if(e===r)return t;for(var i=Math.min(r,e),o=t.slice(0,i),u=e;u<r;++u)l[u]._onDeactivation();for(var a=i;a<e;++a)o[a]=c(l[a]=s(f,a),a);return l.length=e,o},[]),Y)}),Kn=f.curry(function(t,a,c){var f=new Map,l=p.get(t),s=function(t,n,r){return l(t)===r.id},h=Sn(c);return d(c,I(function(t,n){for(var r=n?n.length:0,e=t.length===r?t:Array(r),i=0;i<r;++i){var o=l(n[i]),u=f.get(o);void 0===u&&(f.set(o,u={}),u.id=o,u.hint=i,u.elem=a(u.view=h(c,p.find(s,u)),o)),e[i]!==u.elem&&(u.hint=i,e===t&&(e=e.slice(0)),e[i]=u.elem)}return e!==t&&f.forEach(function(t,n){e[t.hint]!==t.elem&&(t.view._onDeactivation(),f.delete(n))}),e},[]),Y)});t.holding=i.holding,t.combine=u.combine,t.lift=u.lift,t.liftRec=u.liftRec,t.toKaret=o.fromClass,t.debounce=b,t.changes=function(t){return W(t).changes()},t.serially=U,t.parallel=function(t){return c.merge(t.map(W))},t.delay=E,t.mapValue=A,t.flatMapParallel=_,t.flatMapSerial=R,t.flatMapErrors=x,t.flatMapLatest=D,t.foldPast=I,t.interval=C,t.later=q,t.never=S,t.on=F,t.sampledBy=V,t.skipFirst=L,t.skipDuplicates=O,t.skipUnless=j,t.takeFirst=B,t.takeFirstErrors=K,t.takeUntilBy=N,t.toObservable=W,t.toProperty=z,t.throttle=J,t.fromEvents=T,t.ignoreValues=function(t){return t.ignoreValues()},t.ignoreErrors=function(t){return t.ignoreErrors()},t.startWith=G,t.sink=H,t.consume=Q,t.endWith=X,t.lazy=function(t){return z(w(t,W()))},t.skipIdenticals=Y,t.skipWhen=Z,t.template=$,t.fromPromise=function(t){return new tt(t)},t.not=nt,t.and=et,t.or=it,t.ifElse=ut,t.unless=at,t.when=ct,t.cond=function(t){for(var n=arguments.length,r=void 0;n--;){var e=arguments[n];r=1!==e.length?ot(e[0],e[1],r):e[0]}return r},t.Latest=ft,t.IdentityLatest=lt,t.animationSpan=ht,t.Bus=dt,t.bus=yt,t.serializer=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f.array0,r=yt(),e=d(U(n.concat(r)),R(Mt),G(t));return e.push=function(t){return r.push(t)},e.error=function(t){return r.error(t)},e.end=function(){return r.end()},e},t.doPush=mt,t.doError=vt,t.doEnd=gt,t.scope=Mt,t.tapPartial=wt,t.toPartial=function(e){return u.liftRec(f.arityN(e.length,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every(f.isDefined)?e.apply(void 0,n):void 0}))},t.thru=d,t.through=function(){for(var t=arguments.length,n=Array(t),r=!0,e=0;e<t;++e){var i=n[e]=arguments[e];r&&(r=!m(i))}return r?function(t){return kt(t,n)}:(n=$(n),function(t){return Pt(t,n)})},t.show=function(t){for(var n=arguments.length-1,r=Array(n),e=0;e<n;++e)r[e]=arguments[e];var i=u.combine(r,bt),o=arguments[n];return v(o)?m(i)?c.combine([i,o],p.get):A(p.get(i),o):jn(i,o)},t.onUnmount=function(t){return c.stream(f.always(t)).toProperty(f.always(void 0))},t.getProps=function(r){var t=void 0;for(var n in r){if(t)return function(n){i.holding(function(){for(var t in r)Ut(t,r[t])(n)})};t=Ut(n,r[n])}return t},t.setProps=function(t){var i=void 0,o=void 0;return function(e){o&&(i.offAny(o),i=o=null),e&&(o=function(t){switch(t.type){case"value":var n=t.value;for(var r in n)e[r]=n[r];break;case"error":throw t.value;case"end":i=o=null}},(i=$(t)).onAny(o))}},t.Select=At,t.Input=_t,t.TextArea=Rt,t.refTo=function(n){return function(t){null!==t&&n.set(t)}},t.actions=Dt,t.preventDefault=Ct,t.stopPropagation=qt,t.cns=Ft,t.pure=Vt,t.toReactExcept=Lt,t.toReact=Ot,t.parse=jt,t.stringify=Bt,t.decodeURI=Kt,t.decodeURIComponent=Nt,t.encodeURI=Wt,t.encodeURIComponent=zt,t.abs=Jt,t.acos=Tt,t.acosh=Gt,t.asin=Ht,t.asinh=Qt,t.atan=Xt,t.atan2=Yt,t.atanh=Zt,t.cbrt=$t,t.ceil=tn,t.clz32=nn,t.cos=rn,t.cosh=en,t.exp=on,t.expm1=un,t.floor=an,t.fround=cn,t.hypot=fn,t.imul=ln,t.log=sn,t.log10=hn,t.log1p=pn,t.log2=dn,t.max=yn,t.min=mn,t.pow=vn,t.round=gn,t.sign=Mn,t.sin=wn,t.sinh=kn,t.sqrt=Pn,t.tan=bn,t.tanh=Un,t.trunc=En,t.string=An,t.atom=function(t){return new i.Atom(t)},t.variable=function(){return new i.Atom},t.molecule=function(t){return new i.Molecule(t)},t.set=_n,t.doModify=Rn,t.doSet=xn,t.doRemove=Dn,t.destructure=function(t){return e(t)?new Proxy(t,Ln):m(t)?new Proxy(t,On):t},t.view=jn,t.mapElems=Bn,t.mapElemsWithIds=Kn,Object.defineProperty(t,"__esModule",{value:!0})});
